---
import Layout from "../layouts/Layout.astro";
import { getProjects, getReports, getWorks } from "../lib/notion-client";

console.log("=== Index Page Rendering Started ===");
const allProjects = await getProjects();
const allReports = await getReports();
const allWorks = await getWorks();
console.log(
  `=== Projects: ${allProjects.length}, Reports: ${allReports.length}, Works: ${allWorks.length} ===`,
);

// 메인페이지에는 최신 3개만 표시
const projects = allProjects.slice(0, 3);
const reports = allReports.slice(0, 3);
const works = allWorks.slice(0, 6);

// Format date to Korean style
function formatDate(dateStr: string): string {
  if (!dateStr) return "";
  const date = new Date(dateStr);
  return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, "0")}.${String(date.getDate()).padStart(2, "0")}`;
}
---

<Layout title="Blog — LHM">
  <!-- Hero Section -->
  <section class="mb-20">
    <h1 class="page-title mb-6">
      Blog — lhm
      <span class="count"
        >({allProjects.length + allReports.length + allWorks.length})</span
      >
    </h1>
    <p class="about-text">UI/UX 디자이너의 관점에서 UI/UX 기술을 기록합니다.</p>
  </section>

  <!-- Projects Section -->
  <section id="projects" class="mb-20">
    <h2 class="text-sm font-bold uppercase tracking-wider mb-8 opacity-20">
      Projects
    </h2>

    {
      projects.length === 0 ? (
        <div class="py-12 text-center border-t border-gray-200">
          <p class="text-lg font-bold text-gray-400 mb-2">
            게시된 프로젝트가 없습니다.
          </p>
        </div>
      ) : (
        <div class="flex flex-col border-t border-gray-200">
          {projects.map((project) => (
            <a href={`/projects/${project.slug}`} class="blog-item group">
              <span class="blog-title flex-grow">{project.title}</span>
              <span class="blog-date opacity-50 text-right">
                {formatDate(project.date)}
              </span>
            </a>
          ))}
        </div>
      )
    }

    {
      allProjects.length > 3 && (
        <a href="/projects" class="view-all-link">
          View All Projects →
        </a>
      )
    }
  </section>

  <!-- Reports Section -->
  <section id="reports" class="mb-20">
    <h2 class="text-sm font-bold uppercase tracking-wider mb-8 opacity-20">
      Weekly Reports
    </h2>

    {
      reports.length === 0 ? (
        <div class="py-12 text-center border-t border-gray-200">
          <p class="text-lg font-bold text-gray-400 mb-2">
            게시된 리포트가 없습니다.
          </p>
        </div>
      ) : (
        <div class="flex flex-col border-t border-gray-200">
          {reports.map((report) => (
            <a href={`/reports/${report.slug}`} class="blog-item group">
              <span class="blog-title">{report.title}</span>
            </a>
          ))}
        </div>
      )
    }

    {
      allReports.length > 3 && (
        <a href="/reports" class="view-all-link">
          View All Reports →
        </a>
      )
    }
  </section>

  <!-- 3D Modeling Section (Gallery Preview) -->
  <section id="3d-modeling" class="mb-20">
    <h2 class="text-sm font-bold uppercase tracking-wider mb-8 opacity-20">
      3D Modeling
    </h2>

    {
      works.length === 0 ? (
        <div class="py-12 text-center border-t border-gray-200">
          <p class="text-lg font-bold text-gray-400 mb-2">
            게시된 작업물이 없습니다.
          </p>
        </div>
      ) : (
        <div class="gallery-grid">
          {works.map((work) => (
            <a href={`/3d-modeling/${work.slug}`} class="gallery-item group">
              <div class="gallery-thumbnail-wrapper">
                {work.thumbnail ? (
                  <img
                    src={work.thumbnail}
                    alt={work.title}
                    class="gallery-thumbnail"
                    loading="lazy"
                  />
                ) : (
                  <div class="gallery-placeholder">
                    <span>No Preview</span>
                  </div>
                )}
                <div class="gallery-overlay">
                  <h3 class="gallery-item-title">{work.title}</h3>
                </div>
              </div>
            </a>
          ))}
        </div>
      )
    }

    {
      allWorks.length > 6 && (
        <a href="/3d-modeling" class="view-all-link">
          View All 3D Modeling →
        </a>
      )
    }
  </section>

  <!-- About Section -->
  <section id="about">
    <h2 class="text-sm font-bold uppercase tracking-wider mb-8 opacity-20">
      About
    </h2>
    <div class="prose">
      <p>
        저는 UI/UX 디자이너입니다.<br />
        AI를 활용해 넓어지는 UI/UX 디자인을 경험하고, 이것저것 익힌 기술들을 게시합니다.<br
        />
        아직은 막연한 미래를 향한 기록을 남깁니다.
      </p>
    </div>
  </section>
</Layout>
